# 容器文件替换工具

## 📖 简介

`replace-auth.sh` 是一个用于替换容器中文件的自动化脚本。

## ✨ 功能特性

- 🔍 **智能容器检测**: 自动检查容器是否存在
- 🎯 **交互式选择**: 容器不存在时提供手动输入功能
- 🌐 **多重下载**: 支持 curl 和 wget 双重下载方式
- ✅ **文件验证**: 确保下载文件的完整性和有效性
- 🎨 **彩色输出**: 清晰的状态提示和错误信息
- 🧹 **自动清理**: 操作完成后自动清理临时文件
- 📊 **状态监控**: 显示容器运行状态

## 🚀 使用方法

### 基本用法

```bash
rm -f replace-auth.sh && curl -O https://raw.githubusercontent.com/ui86/scripts/refs/heads/main/certd/replace-auth.sh || wget -O ${_##*/} $_ && bash replace-auth.sh
```

### 交互式使用

当默认容器不存在时，脚本会：

1. 显示所有可用容器列表
2. 提示用户输入容器名称或ID
3. 验证输入的容器是否存在
4. 继续执行替换操作

```
警告: 容器 'certd' 不存在
当前系统中的所有容器：
----------------------------------------
NAMES           ID              STATUS
my-certd        a1b2c3d4e5f6    Up 2 hours
nginx-proxy     b2c3d4e5f6a1    Up 1 day
----------------------------------------

请输入容器名称或容器ID (输入 'q' 退出):
> my-certd
```

## 📋 系统要求

### 必需组件
- **Docker**: 用于容器操作
- **Bash**: Shell 环境
- **网络连接**: 用于下载授权文件

### 下载工具（至少一个）
- `curl` - 首选下载工具
- `wget` - 备用下载工具

### 检查系统要求
```bash
# 检查 Docker
docker --version

# 检查下载工具
curl --version
wget --version
```

## 📝 操作流程

1. **容器检测**: 检查目标容器是否存在
2. **状态检查**: 显示容器当前运行状态
3. **文件下载**: 从远程仓库下载授权文件
4. **文件验证**: 验证下载文件的完整性
5. **文件复制**: 将文件复制到容器指定路径
6. **容器重启**: 重启容器以应用更改
7. **清理工作**: 删除临时文件

## ⚠️ 注意事项

### 安全提醒
- 该脚本会修改容器内的核心文件，请确保了解其影响
- 建议在测试环境中先行验证
- 操作前建议备份重要数据

### 权限要求
- 需要 Docker 操作权限
- 需要文件系统写入权限（用于临时文件）

### 网络要求
- 需要访问 GitHub 的网络连接
- 如果网络受限，可能需要配置代理

## 🐛 故障排除

### 常见问题

#### 1. 容器不存在
```
错误: 容器 'certd' 不存在，请重新输入
```
**解决方案**: 
- 检查容器名称拼写
- 使用 `docker ps -a` 查看所有容器
- 确认容器是否已创建

#### 2. 下载失败
```
错误: 下载失败，请检查网络连接
```
**解决方案**:
- 检查网络连接
- 确认防火墙设置
- 尝试手动访问下载地址

#### 3. 复制失败
```
复制文件到容器失败
```
**可能原因**:
- 容器不存在或无法访问
- 目标路径不存在
- 权限不足

**解决方案**:
- 确认容器状态：`docker ps -a`
- 检查目标路径：`docker exec <container> ls -la /app/node_modules/@certd/plus-core/dist/`
- 确认 Docker 权限

#### 4. 重启失败
```
重启容器失败
```
**解决方案**:
- 检查容器配置
- 查看容器日志：`docker logs <container>`
- 手动重启：`docker restart <container>`

### 调试命令

```bash
# 查看所有容器
docker ps -a

# 查看容器日志
docker logs -f <container_name>

# 检查容器内文件
docker exec <container_name> ls -la /app/node_modules/@certd/plus-core/dist/

# 进入容器调试
docker exec -it <container_name> /bin/bash
```

## 📄 许可证

本脚本仅供学习和研究使用，请遵守相关法律法规。